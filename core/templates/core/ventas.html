{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<style>
    /* CSS para estilos visuales */
    body {
        font-family: 'Inter', sans-serif;
        background-color: #c4dafa;
    }
    .card-pv {
        border-radius: 1.5rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
    }
    .input-group input, .input-group select {
        border-radius: 0.75rem;
        border: 1px solid #d1d5db;
    }
    .input-group input:focus, .input-group select:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(132, 182, 244, 0.5);
        border-color: #84b6f4;
    }
    .btn-custom {
        border-radius: 0.75rem;
        transition: transform 0.2s ease-in-out;
    }
    .btn-custom:hover {
        transform: scale(1.02);
    }
    .total-card {
        background-color: #f2f6ff;
        border-radius: 0.75rem;
        border: 1px solid #e0e0e0; 
    }
    .total-card-large {
        font-size: 1.5rem;
        font-weight: 700;
    }
    /* Estilos para el scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }
    ::-webkit-scrollbar-track {
        background: #f2f6ff;
        border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
        background: #84b6f4;
        border-radius: 10px;
    }
</style>

<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <div id="message-container">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card card-pv h-100">
                <div class="card-body">
                    <h4 class="card-title text-center mb-4">Punto de Venta</h4>
                    <form id="venta-form" method="POST">
                        {% csrf_token %} 
                        
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="producto-codigo" placeholder="Código del Producto" aria-label="Código del Producto" aria-describedby="add-item-btn">
                            <button class="btn btn-primary btn-custom" type="button" id="add-item-btn">Añadir</button>
                        </div>
                        
                        <h5 class="mt-4">Items en la Venta</h5>
                        <ul class="list-group mb-4" id="lista-items">
                        </ul>

                        <h5 class="mt-4">Métodos de Pago</h5>
                        <div id="pagos-container">
                        </div>
                        <button class="btn btn-secondary btn-sm mb-3 btn-custom" type="button" id="add-pago-btn">Añadir otro pago</button>

                        <div class="total-card mt-4 p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <strong>Total a Pagar:</strong> 
                                <span id="total-a-pagar-divisa" class="total-card-large">$0.00</span> 
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2" style="font-size: 0.9rem;">
                                <span>(Tasa: BsD **{{ tasa_actual }}**)</span>
                                <span id="total-a-pagar-bsd" class="text-secondary">BsD 0.00</span>
                            </div>
                        </div>
                        
                        <div class="total-card mt-2 p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <strong>Saldo Pendiente:</strong> 
                                <span id="saldo-pendiente" class="total-card-large text-danger">$0.00</span> 
                            </div>
                        </div>

                        <input type="hidden" name="items" id="items-data">
                        <input type="hidden" name="pagos" id="pagos-data">

                        <button type="submit" class="btn btn-success w-100 mt-4 btn-custom" id="finalizar-btn" disabled>Finalizar Venta</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card card-pv h-100">
                <div class="card-body">
                    <h4 class="card-title text-center mb-4">Resumen del Día</h4>
                    <ul class="list-group list-group-flush mb-4">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <strong>Total en Divisas:</strong>
                            <span>${{ total_divisas_hoy|floatformat:2 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <strong>Total en Bolívares:</strong>
                            <span>Bs. {{ total_bs_hoy|floatformat:2 }}</span>
                        </li>
                    </ul>
                    <h5 class="mt-4">Ventas Registradas Hoy:</h5>
                    <div class="table-responsive" style="max-height: 450px; overflow-y: auto;">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID Venta</th>
                                    <th>Total</th>
                                    <th>Fecha</th>
                                    <th>Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for venta in ventas_hoy %}
                                <tr>
                                    <td>{{ venta.id }}</td>
                                    <td>${{ venta.total_venta_divisa|floatformat:2 }}</td>
                                    <td>{{ venta.fecha|date:"H:i" }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-info">Detalles</button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center">No hay ventas registradas hoy.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script id="productos-data" type="application/json">
    {{ productos|safe }}
</script>
<script id="metodos-pago-data" type="application/json">
    {{ metodos_pago|safe }}
</script>
<script id="tasa-actual-data" type="application/json">
    {{ tasa_actual|safe }}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="{% static 'js/ventas.js' %}?v={{ current_time_stamp }}"></script>

{% endblock %}